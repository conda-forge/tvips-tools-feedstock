{% set name = "TVIPS tools" %}
{% set tarname = name|lower|replace(' ', '-') %}
{% set version = "0.0.2-dev.0" %}

package:
  name: {{ tarname }}
  version: {{ version|replace('-dev.', '.dev') }}

source:
  url: https://cryoem.ucla.edu/downloads/{{ tarname }}-{{ version }}.tar.gz
  sha256: 5a41f81690b472f1fdc6d901e9341c8b78e5bf6e5771ffd4a0809e2f6158f9f5
  patches:
    - 01-setenv.patch
    - 02-version.patch
    - 03-install.patch
    - 04-warnings.patch

build:
  ignore_run_exports_from:
    - {{ compiler('cxx') }}
  number: 0
  script_env:
    - USER     # [unix]
    - USERNAME # [win]

requirements:
  build:
    - {{ compiler('c') }}
    - {{ compiler('cxx') }}
    - cmake   >=3.2,<4
    - libxslt >=0.13.0
    - make              # [unix]
  host:
    - libtiff 4.*
  run:
    - {{ pin_compatible('libtiff', max_pin='x.x') }}

test:
  requires:
    - coreutils     # [unix]
    - m2-coreutils  # [win]
    - m2-sed        # [win]
  source_files:
    - test/*.tif
    - test/*.tvips

about:
  home: https://cryoem.ucla.edu/microed
  license: ISC
  license_file: LICENSE
  summary: "Convert diffraction images from TVIPS format to SMV"
  description: |
    The TVIPS tools convert sequences of related electron diffraction
    images, or MicroED sweeps, recorded by Tietz Video and Image
    Processing Systems (TVIPS) cameras to the Super Marty View (SMV)
    format.

extra:
  recipe-maintainers:
    - hattne
